# 要件定義書

## 概要

Angular フロントエンドと ASP.NET Core バックエンドを使用した写真・動画管理アルバムアプリケーション。Google アカウント認証を使用し、管理者権限による ユーザー管理機能を持つ。Docker コンテナ環境で動作し、メディアファイルのアップロード、サムネイル生成、日付ベースの整理機能を提供する。

## 要件

### 要件 1: ユーザー認証とアクセス制御

**ユーザーストーリー:** 管理者として、Google アカウント認証を使用してセキュアなアクセス制御を実装し、承認されたユーザーのみがアプリケーションにアクセスできるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがアプリケーションにアクセス THEN システムは Google OAuth 認証を要求する
2. WHEN 未承認のユーザーがログインを試行 THEN システムはアクセスを拒否し、適切なエラーメッセージを表示する
3. WHEN 承認されたユーザーがログイン THEN システムはアプリケーションへのアクセスを許可する

### 要件 2: 管理者権限によるユーザー管理

**ユーザーストーリー:** 管理者として、バックエンドの設定ファイルを通じて管理者権限を設定し、承認されたユーザーの追加・削除を行いたい

#### 受け入れ基準

1. WHEN 管理者権限のあるユーザーがユーザー管理画面にアクセス THEN システムはユーザー一覧と管理機能を表示する
2. WHEN 管理者がユーザーを追加 THEN システムは新しいユーザーをデータベースに保存し、そのユーザーのアクセスを許可する
3. WHEN 管理者がユーザーを削除 THEN システムはユーザーをデータベースから削除し、そのユーザーのアクセスを無効化する
4. IF ユーザーが管理者権限を持たない THEN システムはユーザー管理機能へのアクセスを拒否する

### 要件 3: メディアファイルのアップロード

**ユーザーストーリー:** ユーザーとして、写真と動画をアップロードして、アルバムに保存したい

#### 受け入れ基準

1. WHEN ユーザーがファイルをアップロード THEN システムはファイルサイズが100MB以下であることを検証する
2. WHEN ユーザーがファイルをアップロード THEN システムはファイル拡張子がJPG、PNG、HEIC、MP4、MOVのいずれかであることを検証する
3. IF ファイルサイズが100MBを超える THEN システムはアップロードを拒否し、エラーメッセージを表示する
4. IF ファイル拡張子が許可されていない THEN システムはアップロードを拒否し、エラーメッセージを表示する
5. WHEN 有効なファイルがアップロードされる THEN システムはファイルを受け入れ、処理を開始する

### 要件 4: ファイルの日付ベース整理

**ユーザーストーリー:** ユーザーとして、アップロードしたメディアファイルが撮影日に基づいて自動的に整理されることを期待する

#### 受け入れ基準

1. WHEN ファイルがアップロードされる THEN システムはファイルのメタデータから撮影日を抽出する
2. WHEN 撮影日が取得される THEN システムは `/data/pict/<YYYYMMDD>` パターンのディレクトリを作成する
3. WHEN ディレクトリが作成される THEN システムは元のファイルをそのディレクトリに保存する
4. IF メタデータから撮影日が取得できない THEN システムはアップロード日を使用してディレクトリを作成する

### 要件 5: サムネイル画像の生成と保存

**ユーザーストーリー:** ユーザーとして、メディアファイルの一覧を素早く閲覧するために、サムネイル画像が表示されることを期待する

#### 受け入れ基準

1. WHEN ファイルがアップロードされる THEN システムはサムネイル画像を生成する
2. WHEN サムネイル画像が生成される THEN システムは縦幅と横幅が300ピクセル以下になるようにリサイズする
3. WHEN サムネイル画像が生成される THEN システムは `/data/thumb/<YYYYMMDD>` パターンのディレクトリを作成する
4. WHEN ディレクトリが作成される THEN システムはサムネイル画像をそのディレクトリに保存する
5. WHEN 動画ファイルがアップロードされる THEN システムは動画の最初のフレームからサムネイル画像を生成する

### 要件 6: メディアファイルの一覧表示

**ユーザーストーリー:** ユーザーとして、アップロードしたメディアファイルをサムネイル形式で一覧表示し、効率的に閲覧したい

#### 受け入れ基準

1. WHEN ユーザーがアルバム画面にアクセス THEN システムはサムネイル画像の一覧を表示する
2. WHEN サムネイル画像が表示される THEN システムは日付順（新しい順）でソートして表示する
3. WHEN ユーザーがサムネイル画像をクリック THEN システムは元のメディアファイルを表示する
4. WHEN 一覧に多数のファイルがある THEN システムはページネーションまたは無限スクロールを提供する

### 要件 7: Docker コンテナ環境での動作

**ユーザーストーリー:** 開発者として、開発環境と実行環境の両方でDocker コンテナを使用して、一貫した環境でアプリケーションを動作させたい

#### 受け入れ基準

1. WHEN 開発者がアプリケーションを起動 THEN システムはDocker Compose を使用してフロントエンドとバックエンドの両方のコンテナを起動する
2. WHEN コンテナが起動される THEN システムはAngular フロントエンドとASP.NET Core バックエンドが正常に通信できることを確認する
3. WHEN ファイルがアップロードされる THEN システムはコンテナ内の永続化ボリュームにファイルを保存する
4. WHEN アプリケーションが再起動される THEN システムは保存されたファイルとデータが保持されることを確認する