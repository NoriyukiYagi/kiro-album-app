# 実装計画

- [x] 1. Docker 環境とプロジェクト構造の設定





  - Docker Compose ファイルを作成し、Angular、ASP.NET Core、PostgreSQL コンテナを定義する
  - 開発環境用の設定でホットリロードとボリュームマウントを設定する
  - プロジェクトのディレクトリ構造を作成し、フロントエンドとバックエンドの基本スケルトンを生成する
  - _要件: 7.1, 7.2, 7.4_

- [x] 2. バックエンド基盤の実装














  - ASP.NET Core プロジェクトを作成し、Entity Framework Core と PostgreSQL の設定を行う
  - User と MediaFile エンティティを定義し、DbContext を設定する
  - データベースマイグレーションを作成し、初期スキーマを生成する
  - _要件: 2.2, 2.3, 4.3, 5.4_

- [ ] 3. Google OAuth 認証の実装
  - Google OAuth 認証ライブラリを設定し、認証フローを実装する
  - JWT トークン生成と検証機能を実装する
  - AuthController を作成し、ログイン・ログアウト・ユーザー情報取得 API を実装する
  - _要件: 1.1, 1.2, 1.3_

- [ ] 4. 認証ミドルウェアとユーザー管理の実装
  - JWT 認証ミドルウェアを実装し、API エンドポイントを保護する
  - 管理者権限チェック機能を実装し、設定ファイルから管理者リストを読み込む
  - UserController を作成し、管理者専用のユーザー管理 API を実装する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 5. ファイルアップロード機能の実装
  - MediaController を作成し、ファイルアップロード API を実装する
  - ファイルサイズ（100MB）と拡張子（JPG, PNG, HEIC, MP4, MOV）の検証機能を実装する
  - ファイルアップロード時のエラーハンドリングを実装する
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 6. メタデータ抽出とファイル整理機能の実装
  - MetadataService を実装し、画像・動画ファイルから撮影日を抽出する機能を作成する
  - FileStorageService を実装し、日付ベースのディレクトリ構造（/data/pict/<YYYYMMDD>）でファイルを保存する機能を作成する
  - メタデータが取得できない場合のフォールバック処理（アップロード日使用）を実装する
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [ ] 7. サムネイル生成機能の実装
  - ThumbnailService を実装し、ImageSharp を使用して画像のサムネイル生成機能を作成する
  - FFMpegCore を使用して動画の最初のフレームからサムネイル生成機能を作成する
  - サムネイルを300ピクセル以下にリサイズし、/data/thumb/<YYYYMMDD> ディレクトリに保存する機能を実装する
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8. メディア一覧取得 API の実装
  - MediaRepository を実装し、データベースからメディアファイル情報を取得する機能を作成する
  - 日付順（新しい順）でソートされたメディア一覧を返す API を実装する
  - ページネーション機能を実装し、大量のファイルに対応する
  - _要件: 6.1, 6.2, 6.4_

- [ ] 9. サムネイル配信 API の実装
  - ThumbnailController を作成し、サムネイル画像を配信する API を実装する
  - ファイルの存在チェックとエラーハンドリングを実装する
  - 適切な Content-Type ヘッダーを設定してサムネイル画像を返す機能を実装する
  - _要件: 6.1, 6.3_

- [ ] 10. Angular フロントエンドプロジェクトの設定
  - Angular プロジェクトを作成し、Angular Material と必要な依存関係を設定する
  - Google OAuth ライブラリを設定し、認証サービスの基盤を作成する
  - HTTP インターセプターを実装し、JWT トークンの自動付与とエラーハンドリングを設定する
  - _要件: 1.1, 1.2, 1.3_

- [ ] 11. 認証コンポーネントの実装
  - AuthService を実装し、Google OAuth ログイン・ログアウト・トークン管理機能を作成する
  - LoginComponent を作成し、Google OAuth ログイン画面を実装する
  - AuthGuard を実装し、未認証ユーザーのアクセス制御を行う
  - _要件: 1.1, 1.2, 1.3_

- [ ] 12. メディアアップロードコンポーネントの実装
  - UploadComponent を作成し、ドラッグ&ドロップ対応のファイルアップロード機能を実装する
  - ファイル選択時の拡張子・サイズ検証をクライアント側で実装する
  - アップロード進捗表示とエラーメッセージ表示機能を実装する
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 13. アルバム一覧表示コンポーネントの実装
  - AlbumListComponent を作成し、サムネイル画像のグリッド表示機能を実装する
  - 無限スクロールまたはページネーション機能を実装する
  - 日付順（新しい順）でのソート表示を実装する
  - _要件: 6.1, 6.2, 6.4_

- [ ] 14. メディアビューアーコンポーネントの実装
  - MediaViewerComponent を作成し、個別メディアファイルの表示機能を実装する
  - 画像と動画の両方に対応した表示機能を実装する
  - サムネイルクリック時の詳細表示機能を実装する
  - _要件: 6.3_

- [ ] 15. 管理者用ユーザー管理コンポーネントの実装
  - AdminUserManagementComponent を作成し、管理者専用のユーザー管理画面を実装する
  - ユーザー一覧表示、追加、削除機能を実装する
  - 管理者権限チェックによるアクセス制御を実装する
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 16. 共通コンポーネントとナビゲーションの実装
  - HeaderComponent を作成し、ナビゲーションメニューとユーザー情報表示を実装する
  - LoadingComponent と ErrorComponent を作成し、統一されたUI表示を実装する
  - ルーティング設定を行い、各コンポーネント間のナビゲーションを実装する
  - _要件: 1.3, 2.4_

- [ ] 17. エラーハンドリングとバリデーションの実装
  - バックエンドにグローバル例外ミドルウェアを実装し、統一されたエラーレスポンスを返す
  - フロントエンドにグローバルエラーハンドラーを実装し、ユーザーフレンドリーなエラー表示を行う
  - フォームバリデーションとファイルアップロード時の詳細なエラーメッセージを実装する
  - _要件: 3.3, 3.4, 2.2, 2.3_

- [ ] 18. 本番環境用 Docker 設定の実装
  - 本番環境用の Docker Compose ファイルを作成し、Nginx リバースプロキシを設定する
  - Angular のプロダクションビルド設定を行い、最適化されたファイルを生成する
  - データベースとファイルのバックアップ設定を実装する
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 19. テストの実装
  - バックエンドの単体テストを xUnit で実装し、サービスとコントローラーの機能をテストする
  - フロントエンドの単体テストを Jasmine + Karma で実装し、コンポーネントとサービスをテストする
  - 統合テストを実装し、API エンドポイントとデータベース連携をテストする
  - _要件: 全要件の品質保証_

- [ ] 20. システム統合とデプロイメント準備
  - 全コンポーネントを統合し、エンドツーエンドの動作確認を行う
  - 設定ファイルのテンプレートを作成し、環境変数による設定管理を実装する
  - README ファイルを作成し、セットアップ手順とデプロイメント手順を文書化する
  - _要件: 7.1, 7.2, 7.3, 7.4_